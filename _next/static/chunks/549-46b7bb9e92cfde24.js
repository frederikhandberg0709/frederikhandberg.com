"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[549],{33549:(e,t,r)=>{r.d(t,{A:()=>b});var l=r(95155),s=r(97049);function a(e){if(!e)return"";let t=new Date(1e3*e.created_at),r=t.getFullYear(),l=("0"+(t.getMonth()+1)).slice(-2),s=("0"+t.getDate()).slice(-2),a=t.getHours(),n=a,i=("0"+t.getMinutes()).slice(-2),d="AM";return a>12?(n=a-12,d="PM"):12===a?(n=12,d="PM"):0==a&&(n=12),s+"-"+l+"-"+r+", "+n+":"+i+" "+d}var n=r(88275);let i=e=>{let t=e.match(/https:\/\/.*?\.(jpeg|jpg|png|webp)/gi),r=e.match(/https:\/\/.*?\.(mp4|avi|mov)/gi);return{images:t?[...t]:[],videos:r?[...r]:[]}};function d(e){let t=i(e),r=e;return{mediaUrls:t,textContent:(r=(r=(r=(r=(r=(r=(r=(r=(r=(r=r.replace(/https:\/\/.*\.(jpeg|jpg|png|mp4|avi|mov|webp)/gi,"")).replace(/(nostr:note[a-zA-Z0-9]{59,65})/g,e=>{let t=e.substring(0,10),r=e.substring(e.length-6);return"".concat(t,"...").concat(r)})).replace(/(note1[a-zA-Z0-9]{20,})/g,e=>{let t=e.substring(0,5),r=e.substring(e.length-6);return"".concat(t,"...").concat(r)})).replace(/(nevent1[a-zA-Z0-9]{20,})/g,e=>{let t=e.substring(0,7),r=e.substring(e.length-6);return"".concat(t,"...").concat(r)})).replace(/(nostr:npub[a-zA-Z0-9]{59,65})/g,e=>{let t=e.substring(0,10),r=e.substring(e.length-6);return"".concat(t,"...").concat(r)})).replace(/(https?:\/\/[^\s]{30,})/g,e=>{try{let t=new URL(e).hostname;return"".concat(t,"/...")}catch(t){return"".concat(e.substring(0,25),"...")}})).replace(/\n{3,}/g,"\n\n")).split("\n").map(e=>""===e.trim()?"":e).join("\n")).replace(/\n\n\n+/g,"\n\n")).replace(/[ ]{2,}/g," ")).trim()}}var c=r(12115);let o=function(e){let t=/(#\w+)/g,r=e.split(/(\s+)/).flatMap(e=>e.split(t));return(0,l.jsx)(c.Fragment,{children:r.map((e,t)=>e.startsWith("#")?(0,l.jsx)("span",{className:"font-bold text-blue-500",children:e},t):(0,l.jsx)("span",{children:e},t))})};var u=r(98590);let g=()=>{let e=(0,c.useContext)(u.b);if(void 0===e)throw Error("useImageOverlay must be used within an ImageOverlayProvider");return e};var m=r(71007),h=r(71366),x=r(66766),p=r(90637);let f=e=>{let{noteId:t}=e,[r,i]=(0,c.useState)(!1),u=function(e){try{if(e.startsWith("note1")){let{data:t}=n.Qe.decode(e);if("string"==typeof t&&/^[a-f0-9]{64}$/.test(t))return t;return console.error("Decoded note ID is not in the expected hex format:",t),""}if(/^[a-f0-9]{64}$/.test(e))return e;return console.error("Note ID is not in a recognized format:",e),""}catch(e){return console.error("Error decoding note ID:",e),""}}(t),{loadProfile:g,getProfile:h}=(0,p.K)(),{events:f,isLoading:v}=(0,s.zE)({filter:{ids:u?[u]:[],kinds:[1],limit:1},enabled:!!u}),b=f.length>0?f[0]:null;(0,c.useEffect)(()=>{(null==b?void 0:b.pubkey)&&g(b.pubkey)},[null==b?void 0:b.pubkey,g]);let y=(null==b?void 0:b.pubkey)?h(b.pubkey):null;if(v)return(0,l.jsxs)("div",{className:"animate-pulse rounded-md border bg-gray-50 p-3 dark:bg-gray-800",children:[(0,l.jsx)("div",{className:"mb-2 h-4 w-3/4 rounded bg-gray-200 dark:bg-gray-700"}),(0,l.jsx)("div",{className:"h-4 w-1/2 rounded bg-gray-200 dark:bg-gray-700"})]});if(!u)return(0,l.jsx)("div",{className:"rounded-md border bg-gray-50 p-4 dark:bg-gray-800",children:(0,l.jsx)("div",{className:"text-sm text-red-500",children:"Invalid note ID format"})});if(!b)return null;let{mediaUrls:j,textContent:N}=d(b.content),k=N.trim().length>0;return(0,l.jsxs)("div",{className:"rounded-lg border border-gray-200 p-4 transition hover:border-gray-300 dark:border-gray-900 dark:bg-black dark:hover:border-gray-800",children:[(0,l.jsxs)("div",{className:"mb-2 flex items-center",children:[(0,l.jsxs)("div",{className:"group flex items-center gap-2",children:[(null==y?void 0:y.picture)&&!r?(0,l.jsx)(x.default,{src:y.picture,alt:"".concat(y.display_name,"'s profile"),width:30,height:30,onError:()=>i(!0),className:"h-[30px] w-[30px] rounded-full object-cover"}):(0,l.jsx)("div",{className:"flex h-[30px] w-[30px] items-center justify-center rounded-full bg-gray-200 dark:bg-gray-700",children:(0,l.jsx)(m.A,{size:16,className:"text-gray-400"})}),(0,l.jsxs)("div",{className:"flex items-center gap-2.5",children:[(0,l.jsx)("div",{className:"text-sm font-semibold text-black group-hover:text-blue-500 dark:text-white",children:(null==y?void 0:y.display_name)||(null==y?void 0:y.name)||"".concat(b.pubkey.substring(0,8),"...")}),(0,l.jsxs)("div",{className:"text-sm text-gray-500",children:["@",null==y?void 0:y.name]})]})]}),(0,l.jsx)("div",{className:"ml-auto text-right text-xs text-gray-500",children:a(b)})]}),k&&(0,l.jsx)("div",{className:"hyphens-auto whitespace-pre-wrap text-sm leading-normal",children:o(N)}),j.images&&j.images.length>0&&(0,l.jsx)("div",{className:"mt-2",children:(0,l.jsx)(x.default,{src:j.images[0],alt:"Embedded media",width:300,height:200,className:"max-h-[500px] w-auto rounded-md object-cover"})})]})};function v(e){let{profilePicture:t,displayName:r,username:s,content:i,showReplies:u=!1,replies:v=[],onToggleReplies:b,timestamp:y,pubkey:j}=e,{setOverlayImage:N}=g(),[k,w]=(0,c.useState)(!1),[E,z]=(0,c.useState)([]),{mediaUrls:S,textContent:C}=d(i),{loadProfile:_,getProfile:A}=(0,p.K)();(0,c.useEffect)(()=>{j&&_(j)},[j,_]);let I=j?A(j):null,P=t||(null==I?void 0:I.picture),M=r||(null==I?void 0:I.display_name),L=s||(null==I?void 0:I.name);(0,c.useEffect)(()=>{z(function(e){let t,r,l=/(note1[a-zA-Z0-9]{20,})/g,s=/(nevent1[a-zA-Z0-9]{20,})/g,a=[];for(;null!==(t=l.exec(e));)t[1]&&a.push(t[1]);for(;null!==(r=s.exec(e));)if(r[1]){let e=r[1];try{let{type:t,data:r}=n.Qe.decode(e);if("note"===t){let e=n.Qe.noteEncode(r);a.push(e)}else if("nevent"===t){let e=n.Qe.noteEncode(r.id);a.push(e)}}catch(e){console.error("Error decoding nevent ID:",e)}}return a}(i))},[i]);let D=e=>{let{images:t,videos:r}=e;return(null==t?void 0:t.length)||(null==r?void 0:r.length)?(0,l.jsxs)("div",{className:"flex flex-col gap-4",children:[t.map((e,t)=>(0,l.jsx)("div",{className:"relative",children:(0,l.jsx)(x.default,{src:e,alt:"Media content ".concat(t+1),onClick:()=>N(e),width:1e3,height:1e3,className:"w-full scale-100 cursor-pointer rounded-xl transition hover:opacity-90 active:scale-[0.98]",onError:()=>w(!0)})},"img-".concat(t))),r.map((e,t)=>(0,l.jsx)("video",{src:e,className:"w-full rounded-[10px]",controls:!0,autoPlay:!0,muted:!0},"video-".concat(t)))]}):null},Z=(e,t)=>e.filter(e=>{let r=e.tags.filter(e=>"e"===e[0]);if(0===r.length)return!1;let l=r[r.length-1];return l&&l[1]===t}).sort((e,t)=>e.created_at-t.created_at),O=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=A(e.pubkey),{mediaUrls:s,textContent:n}=d(e.content),i=Math.min(t,6),c=Z(v,e.id);return(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{style:{marginLeft:"".concat(16*i,"px")},className:"border-l-2 border-gray-300 py-3 pl-3 dark:border-gray-600",children:(0,l.jsxs)("div",{className:"flex items-start gap-3",children:[(null==r?void 0:r.picture)?(0,l.jsx)(x.default,{src:r.picture,alt:"".concat(r.display_name,"'s profile picture"),width:32,height:32,className:"h-8 w-8 rounded-full object-cover"}):(0,l.jsx)("div",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-gray-200 dark:bg-gray-800",children:(0,l.jsx)(m.A,{size:16,className:"text-gray-400"})}),(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2 text-xs text-gray-600 dark:text-gray-400",children:[(0,l.jsx)("span",{className:"font-semibold",children:(null==r?void 0:r.display_name)||"@".concat(null==r?void 0:r.name)||0}),(0,l.jsx)("span",{children:"â€¢"}),(0,l.jsx)("span",{children:a(e)})]}),(0,l.jsx)("div",{className:"mt-1 whitespace-pre-wrap text-sm leading-normal",children:o(n)}),(s.images.length>0||s.videos.length>0)&&(0,l.jsx)("div",{className:"mt-2",children:D(s)})]})]})}),c.length>0&&(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)("div",{className:"absolute bottom-0 top-0 w-0.5 bg-gray-300 dark:bg-gray-600",style:{left:"".concat(16*i,"px")}}),(0,l.jsx)("div",{children:c.map(e=>O(e,t+1))})]})]},e.id)},K=C.trim().length>0,Q=v.length>0;return(0,l.jsxs)("div",{className:"flex flex-col gap-2.5 border-gray-200 px-4 py-4 transition duration-200 hover:border-gray-300 dark:border-gray-900 dark:bg-black dark:hover:border-gray-800 max-sm:py-5 sm:w-[600px] sm:rounded-2xl sm:border",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{className:"group flex gap-[10px]",children:[P&&!k?(0,l.jsx)(x.default,{src:P,alt:"".concat(M,"'s profile picture"),width:40,height:40,onError:()=>w(!0),className:"h-[40px] w-[40px] rounded-full object-cover"}):(0,l.jsx)("div",{className:"flex h-[40px] w-[40px] items-center justify-center rounded-full bg-gray-200 dark:bg-gray-800",children:(0,l.jsx)(m.A,{size:24,className:"text-gray-400"})}),(0,l.jsxs)("div",{className:"flex flex-col gap-px",children:[(0,l.jsx)("p",{className:"text-sm font-bold group-hover:text-blue-500",children:M||(0,l.jsx)("span",{className:"animate-pulse",children:"Loading..."})}),(0,l.jsxs)("p",{className:"text-sm text-gray-500",children:["@",L||(j?j.substring(0,8):"anonymous")]})]})]}),(0,l.jsx)("div",{className:"flex items-center gap-[15px] max-sm:gap-2.5",children:(0,l.jsx)("p",{className:"text-right text-sm text-gray-500",children:a(y)})})]}),K&&(0,l.jsx)("div",{className:"whitespace-pre-wrap leading-normal",children:o(C)}),D(S),E.length>0&&(0,l.jsx)("div",{className:"mt-4",children:E.map(e=>(0,l.jsx)(f,{noteId:e},e))}),Q&&b&&(0,l.jsx)("div",{className:"mt-4 flex items-center justify-start",children:(0,l.jsxs)("button",{onClick:b,className:"flex items-center gap-2 rounded-full bg-gray-100 px-3 py-1.5 text-sm text-gray-600 transition-colors hover:bg-gray-200 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-gray-700",children:[(0,l.jsx)(h.A,{size:16}),(0,l.jsx)("span",{children:v.length}),(0,l.jsx)("span",{children:1===v.length?"reply":"replies"}),(0,l.jsx)("svg",{className:"h-4 w-4 transition-transform ".concat(u?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})}),u&&Q&&(0,l.jsxs)("div",{className:"mt-4 space-y-3 rounded-lg",children:[(0,l.jsxs)("div",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:[v.length," ",1===v.length?"reply":"replies",":"]}),Z(v,y.id).map(e=>O(e,0))]})]})}function b(e){let{filterType:t,maxElements:r}=e,[a,n]=(0,c.useState)(new Set),{events:d}=(0,s.zE)({filter:{authors:["9c9f81ed795f0f5efa558932824687d84fc7e6a4cfa6db5d6d3b50fcb7ffaec2"],since:0,kinds:[1],limit:20}}),o=(0,c.useMemo)(()=>d.map(e=>e.id),[d]),{events:u}=(0,s.zE)({filter:{kinds:[1],"#e":o,since:0,limit:100},enabled:o.length>0}),{events:g}=(0,s.zE)({filter:{kinds:[1],"#p":["9c9f81ed795f0f5efa558932824687d84fc7e6a4cfa6db5d6d3b50fcb7ffaec2"],since:0,limit:50}}),{getProfile:m,loadProfile:h}=(0,p.K)();(0,c.useEffect)(()=>{let e=[...d,...u,...g];e.length>0&&[...new Set(e.map(e=>e.pubkey))].forEach(e=>{h(e)}),console.log("events: ",e)},[d,u,g,h]);let x=e=>[...u.filter(t=>t.tags.some(t=>"e"===t[0]&&t[1]===e)),...g.filter(t=>t.tags.some(t=>"e"===t[0]&&t[1]===e)||t.content.includes(e))].filter((e,t,r)=>t===r.findIndex(t=>t.id===e.id)).sort((e,t)=>e.created_at-t.created_at),f=e=>{n(t=>{let r=new Set(t);return r.has(e)?r.delete(e):r.add(e),r})};return(0,l.jsx)("div",{className:"flex flex-col items-center overflow-x-hidden sm:gap-5",children:d.filter(e=>{if(e.tags.some(t=>!!("e"===t[0]&&o.includes(t[1]))||"p"===t[0]&&"9c9f81ed795f0f5efa558932824687d84fc7e6a4cfa6db5d6d3b50fcb7ffaec2"===t[1]&&e.tags.some(e=>"e"===e[0])))return!1;let{images:r,videos:l}=i(e.content);return"image"===t&&!!(r.length>0)||"video"===t&&!!(l.length>0)||"text"===t&&0===r.length&&0===l.length||"all"===t}).slice(0,r).map(e=>{let t=m(e.pubkey),r=x(e.id),s=a.has(e.id);return(0,l.jsx)("div",{className:"w-full",children:(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)(v,{profilePicture:null==t?void 0:t.picture,displayName:null==t?void 0:t.display_name,username:null==t?void 0:t.name,timestamp:e,content:e.content,replies:r,showReplies:s,pubkey:e.pubkey,onToggleReplies:()=>f(e.id)}),(0,l.jsx)("div",{className:"h-px w-full bg-gray-200 dark:bg-gray-800 sm:h-0"})]})},e.id)})})}},90637:(e,t,r)=>{r.d(t,{H:()=>i,K:()=>d});var l=r(95155),s=r(12115),a=r(97049);let n=(0,s.createContext)({profiles:{},getProfile:()=>null,loadProfile:()=>{},isLoadingProfile:()=>!1});function i(e){let{children:t}=e,[r,i]=(0,s.useState)({}),[d,c]=(0,s.useState)(new Set),[o,u]=(0,s.useState)(new Set),g=(0,s.useRef)(new Set),{events:m}=(0,a.zE)({filter:{authors:Array.from(o),kinds:[0],limit:50},enabled:o.size>0});return(0,s.useEffect)(()=>{if(m.length>0){let e=new Set;i(t=>{let r={...t},l=!1;return m.forEach(s=>{try{if(e.add(s.pubkey),!t[s.pubkey]){let e=JSON.parse(s.content);r[s.pubkey]=e,l=!0}}catch(e){console.error("Error parsing profile:",e)}}),l?r:t}),e.size>0&&c(t=>{let r=new Set(t);return e.forEach(e=>{r.delete(e)}),r})}},[m]),(0,l.jsx)(n.Provider,{value:{profiles:r,getProfile:e=>r[e]||null,loadProfile:e=>{!(!e||r[e]||g.current.has(e))&&(d.has(e)||o.has(e)||(u(t=>{let r=new Set(t);return r.add(e),r}),c(t=>{let r=new Set(t);return r.add(e),r})))},isLoadingProfile:e=>d.has(e)},children:t})}let d=()=>(0,s.useContext)(n)},98590:(e,t,r)=>{r.d(t,{b:()=>a,p:()=>n});var l=r(95155),s=r(12115);let a=(0,s.createContext)({overlayImage:null,setOverlayImage:()=>{}}),n=e=>{let{children:t}=e,[r,n]=(0,s.useState)(null),i=(0,s.useCallback)(e=>{n(e),e?document.body.style.overflow="hidden":document.body.style.overflow="auto"},[]);return(0,s.useEffect)(()=>{let e=e=>{"Escape"===e.key&&r&&i(null)};return r&&window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[r,i]),(0,l.jsxs)(a.Provider,{value:{overlayImage:r,setOverlayImage:i},children:[t,r&&(0,l.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-75 backdrop-blur-sm",onClick:e=>{e.target===e.currentTarget&&i(null)},children:(0,l.jsxs)("div",{className:"relative max-h-full max-w-full overflow-hidden",children:[(0,l.jsx)("button",{className:"absolute right-0 top-0 m-4 rounded-full bg-black/50 px-2 py-1 font-semibold text-white hover:bg-black/95",onClick:()=>i(null),children:"Close"}),(0,l.jsx)("img",{src:r,alt:"Fullscreen",className:"max-h-[90vh] max-w-[90vw] rounded-lg"})]})})]})}}}]);